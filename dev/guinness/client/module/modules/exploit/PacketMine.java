package dev.guinness.client.module.modules.exploit;

import dev.guinness.client.util.RenderUtil;
import java.awt.Color;
import dev.guinness.client.util.ColorUtil;
import net.minecraft.init.Blocks;
import net.minecraft.block.Block;
import net.minecraft.block.state.IBlockState;
import net.minecraft.block.BlockLiquid;
import net.minecraft.world.World;
import net.minecraftforge.fml.common.eventhandler.SubscribeEvent;
import net.minecraft.network.Packet;
import net.minecraft.network.play.client.CPacketPlayerDigging;
import dev.guinness.client.event.events.DamageBlockEvent;
import dev.guinness.client.module.Category;
import net.minecraft.util.math.BlockPos;
import dev.guinness.client.module.Module;

public class PacketMine extends Module
{
    public BlockPos pos;
    
    public PacketMine() {
        super("PacketMine", Category.EXPLOIT, "Mines blocks using packets");
        this.pos = null;
    }
    
    @SubscribeEvent
    public void onDamageBlock(final DamageBlockEvent damageBlockEvent) {
        if (this.canBreak(damageBlockEvent.getPos())) {
            PacketMine.mc.player.connection.sendPacket((Packet)new CPacketPlayerDigging(CPacketPlayerDigging.Action.START_DESTROY_BLOCK, damageBlockEvent.getPos(), damageBlockEvent.getDirection()));
            PacketMine.mc.player.connection.sendPacket((Packet)new CPacketPlayerDigging(CPacketPlayerDigging.Action.STOP_DESTROY_BLOCK, damageBlockEvent.getPos(), damageBlockEvent.getDirection()));
            if (this.pos == null) {
                this.pos = damageBlockEvent.getPos();
            }
        }
    }
    
    public boolean canBreak(final BlockPos blockPos) {
        final IBlockState blockState = PacketMine.mc.world.func_180495_p(blockPos);
        final Block block = blockState.getBlock();
        if (block.getBlockHardness(blockState, (World)PacketMine.mc.world, blockPos) != Float.intBitsToFloat(Float.floatToIntBits(-12.145011f) ^ 0x7EC251F7)) {
            if (!(block instanceof BlockLiquid)) {
                return true;
            }
        }
        return false;
    }
    
    @Override
    public void onRender3d() {
        if (this.pos == null) {
            return;
        }
        if (PacketMine.mc.world.func_180495_p(this.pos).getBlock() == Blocks.AIR) {
            this.pos = null;
            return;
        }
        RenderUtil.drawFilledBox(this.pos, Double.longBitsToDouble(Double.doubleToLongBits(1.2269464450754802E308) ^ 0x7FE5D722994B05CBL), new Color(ColorUtil.BESTCOLOR(0, 255)));
        RenderUtil.drawBlockOutline(this.pos, Double.longBitsToDouble(Double.doubleToLongBits(2.887725020246311E307) ^ 0x7FC48FB059CF40B7L), new Color(ColorUtil.BESTCOLOR(0, 255)), new Color(ColorUtil.BESTCOLOR(0, 255)));
    }
    
    @Override
    public void onEnable() {
        this.pos = null;
    }
    
    @Override
    public void onDisable() {
        this.pos = null;
    }
}

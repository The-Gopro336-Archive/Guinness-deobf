package dev.guinness.client.module.modules.exploit;

import net.minecraft.network.Packet;
import net.minecraft.network.play.client.CPacketVehicleMove;
import dev.guinness.client.util.MessageUtil;
import dev.guinness.client.module.Category;
import net.minecraft.entity.Entity;
import dev.guinness.client.module.Module;

public class EntityDesync extends Module
{
    public Entity ridingEntity;
    
    public EntityDesync() {
        super("EntityDesync", Category.EXPLOIT, "Silently dismounts you from your riding entity to perform various exploits");
    }
    
    @Override
    public void onEnable() {
        if (!EntityDesync.mc.player.func_184218_aH()) {
            MessageUtil.sendModuleErrorMessage(this, "You are not riding an entity!");
            this.disable();
            return;
        }
        this.ridingEntity = EntityDesync.mc.player.func_184187_bx();
        EntityDesync.mc.player.dismountRidingEntity();
        EntityDesync.mc.world.removeEntity(this.ridingEntity);
    }
    
    @Override
    public void onDisable() {
        if (this.ridingEntity != null) {
            this.ridingEntity.isDead = false;
        }
        if (!EntityDesync.mc.player.func_184218_aH() && this.ridingEntity != null) {
            EntityDesync.mc.world.spawnEntity(this.ridingEntity);
            EntityDesync.mc.player.startRiding(this.ridingEntity, true);
        }
        this.ridingEntity = null;
    }
    
    @Override
    public void onUpdate() {
        if (this.ridingEntity == null || EntityDesync.mc.player.func_184218_aH()) {
            return;
        }
        EntityDesync.mc.player.field_70122_E = true;
        this.ridingEntity.setPosition(EntityDesync.mc.player.field_70165_t, EntityDesync.mc.player.field_70163_u, EntityDesync.mc.player.field_70161_v);
        EntityDesync.mc.player.connection.sendPacket((Packet)new CPacketVehicleMove(this.ridingEntity));
    }
}

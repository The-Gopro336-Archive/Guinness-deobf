package dev.guinness.client.module.modules.exploit;

import net.minecraftforge.fml.common.eventhandler.SubscribeEvent;
import java.util.Iterator;
import net.minecraft.entity.item.EntityEnderCrystal;
import net.minecraft.entity.Entity;
import net.minecraft.init.SoundEvents;
import net.minecraft.util.SoundCategory;
import net.minecraft.network.play.server.SPacketSoundEffect;
import dev.guinness.client.event.events.PacketEvent$PacketReceiveEvent;
import dev.guinness.client.module.Category;
import dev.guinness.client.module.Module;

public class CrystalRemover extends Module
{
    public CrystalRemover() {
        super("CrystalRemover", Category.EXPLOIT, "Removes crystals in godmode");
    }
    
    @SubscribeEvent
    public void onPacketReceive(final PacketEvent$PacketReceiveEvent packetEvent$PacketReceiveEvent) {
        if (packetEvent$PacketReceiveEvent.getPacket() instanceof SPacketSoundEffect) {
            final SPacketSoundEffect packet = (SPacketSoundEffect)packetEvent$PacketReceiveEvent.getPacket();
            if (packet.getCategory().equals(SoundCategory.BLOCKS) && packet.getSound() == SoundEvents.ENTITY_GENERIC_EXPLODE) {
                for (final Entity entity : CrystalRemover.mc.world.field_72996_f) {
                    if (entity instanceof EntityEnderCrystal && entity.getDistance(packet.getX(), packet.getY(), packet.getZ()) <= Double.longBitsToDouble(Double.doubleToLongBits(0.37988148642957004) ^ 0x7FC04FFA70248927L)) {
                        entity.setDead();
                    }
                }
            }
        }
    }
}
